[![Python Code Quality Checks](https://github.com/ZhikharevAl/fake_it_till_you_make_it/actions/workflows/code-quality.yaml/badge.svg)](https://github.com/ZhikharevAl/fake_it_till_you_make_it/actions/workflows/code-quality.yaml)

# Проект автоматизации тестирования API "Charity Event"

## Описание

Этот репозиторий содержит набор автоматизированных тестов для API бэкенда "ExpressJS API". Цель проекта — обеспечить качество и стабильность API, используемого для управления пользователями, их авторизацией, избранными запросами и запросами о помощи.

Тесты написаны на Python с использованием pytest и Playwright (для взаимодействия с API).

## Основные возможности и покрытие

На данный момент проект включает тесты для следующих эндпоинтов:

* **Аутентификация:**
  * `POST /api/auth`: Вход пользователя и получение JWT токена.
* **Управление пользователем:**
  * `GET /api/user`: Получение данных профиля текущего пользователя.
  * `GET /api/user/favourites`: Получение списка избранных запросов.
  * `POST /api/user/favourites`: Добавление запроса в избранное.
  * `DELETE /api/user/favourites/{requestId}`: Удаление запроса из избранного.
* **Запросы помощи:**
  * `GET /api/request`: Получение списка всех запросов помощи.
  * `GET /api/request/{id}`: Получение деталей конкретного запроса.
  * `POST /api/request/{id}/contribution`: Внесение вклада в запрос.

## Технологический стек

* **Язык:** Python 3.13+
* **Тест-фреймворк:** pytest
* **HTTP Клиент:** Playwright (APIRequestContext)
* **Валидация данных:** Pydantic
* **Отчетность:** Allure Report
* **Менеджер пакетов:** uv
* **Контейнеризация:** Podman
* **CI/CD:** GitHub Actions

## Структура проекта

```bash
├── .github/          # Настройки CI/CD (GitHub Actions)
│   ├── actions/      # Reusable actions (setup)
│   └── workflows/    # Пайплайны CI/CD
├── api/              # Клиенты API и модели данных (Pydantic)
│   ├── auth/
│   ├── request/
│   └── user/
├── config/           # Конфигурационные файлы (базовый URL, таймауты)
├── core/             # Базовые компоненты фреймворка (HTTP клиент)
├── fixtures/         # Тестовые данные, моки (в будущем)
├── tests/            # Тестовые сценарии pytest
│   ├── auth/
│   ├── request/
│   └── user/
├── utils/            # Вспомогательные утилиты (Allure, хелперы)
├── .env.example      # Пример файла с переменными окружения (НУЖНО СОЗДАТЬ)
├── .gitignore
├── Сontainerfile        # Dockerfile для сборки образа тестов
├── pyproject.toml    # Определение зависимостей и конфигурация инструментов
└── README.md
```

## Установка и настройка

1. **Клонировать репозиторий:**

    ```bash
    git clone https://github.com/ZhikharevAl/fake_it_till_you_make_it.git
    cd fake_it_till_you_make_it
    ```

2. **Установить Python** (версия 3.13 или выше).
3. **Установить `uv`** (если еще не установлен):

    ```bash
    curl -LsSf https://astral.sh/uv/install.sh | sh
    # Не забудьте добавить путь к uv в PATH
    ```

4. **Создать и активировать виртуальное окружение** (рекомендуется):

    ```bash
    uv venv # Создать .venv
    source .venv/bin/activate # Активировать (для Linux/macOS)
    # .\ .venv\Scripts\activate # Активировать (для Windows)
    ```

5. **Установить зависимости:**

    ```bash
    uv pip install -e '.[dev]'
    ```

6. **Настроить окружение:**
    * Скопируйте `.env.example` в `.env`.
    * Заполните файл `.env` необходимыми значениями:
        * `API_BASE_URL`: Базовый URL API сервера (например, `http://localhost:4040`).
        * `TEST_USER_LOGIN`: Логин тестового пользователя.
        * `TEST_USER_PASSWORD`: Пароль тестового пользователя.
        * `INVALID_USER_PASSWORD`: Невалидный пароль для негативных тестов.

## Запуск тестов

1. **Убедитесь, что API сервер запущен** (локально или в контейнере).
2. **Активируйте виртуальное окружение** (если не активно): `source .venv/bin/activate`.
3. **Запустите все тесты:**

    ```bash
    pytest
    ```

4. **Запустите тесты с генерацией Allure результатов:**

    ```bash
    pytest --alluredir=allure-results
    ```

5. **Просмотр Allure отчета:**

    ```bash
    allure serve allure-results
    ```

6. TO DO : **Запуск в Podman:** См. инструкции в CI пайплайне (`.github/workflows/ci.yml`) для примера запуска тестов и сервера в контейнерах Podman с использованием сети хоста или пользовательской сети.

## CI/CD

Проект использует GitHub Actions для автоматической проверки качества кода (linting, formatting, type checking) и запуска тестов при каждом пуше. Результаты тестов и отчет о покрытии загружаются автоматически. Allure отчет генерируется и деплоится на GitHub Pages.

## Планы и улучшения ("To Do")

* **Мокирование API:** Реализовать тесты с использованием моков для изоляции от нестабильного бэкенда и проверки специфичных сценариев ответа сервера.
* **Расширение покрытия:** Добавить больше негативных тестов, тестов на граничные значения и, возможно, тесты производительности.
* **Стабилизация API:** Основная цель — добиться стабильной работы реального API сервера.
* **Улучшение обработки данных:** Использовать фабрики данных или `faker` для генерации тестовых данных.
* **Параллельный запуск:** Настроить параллельный запуск тестов для ускорения прогона.
